---
title: "Untitled"
author: "HW4"
date: "2025-02-14"
output: pdf_document
---

```{r setup, include = FALSE}

# Set up the default parameters
# 1. The code block will not be shown in the document
# 2. set up figure display size
# 3. turn off all the warnings and messages

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width = 8, fig.height = 4)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

```

# Background

For this data analysis, you will analyze the daily and weekly domestic passenger count arriving in Hawaii airports. File *DailyDomestic.csv* contains the *daily* number of passengers between May 2019 and February 2023 File *WeeklyDomestic.csv* contains the *weekly* number of passengers for the same time period. Here we will use different ways of fitting the ARIMA model while dealing with trend and seasonality.

```{r library}

library(lubridate)
library(mgcv)
library(tseries)
library(car)

```

# Instructions on reading the data

To read the data in `R`, save the file in your working directory (make sure you have changed the directory if different from the R working directory) and read the data using the `R` function `read.csv()`

```{r load data}
daily <- read.csv("DailyDomestic.csv", head = TRUE)
daily$date <- as.Date(daily$date)
weekly <- read.csv("WeeklyDomestic.csv", head = TRUE)
weekly$week <- as.Date(weekly$week)

```

# Question 1. Trend and seasonality estimation

**1a.** Plot the daily and weekly domestic passenger count separately. Do you see a strong trend and seasonality?

```{r}
# plot daily passenger count
head(daily)
# extract data in count column into a list vector, then fit a trend based on the list
gam.fit = gam(daily$domestic~s(c(1:length(daily$domestic))))
daily.trend = fitted(gam.fit)
# plot counts and its trend.
daily.plot = plot(daily$date, daily$domestic, xlab="daily", ylab="daily count", type = "l")
lines(daily$date, daily.trend, lwd = 2, col="red")

#plot weekly passenger count
head(weekly)
weekly.plot = plot(weekly$week, weekly$domestic, xlab="week", ylab="weekly count", type="l")
```

*Response*
From both plots, there is a strong cyclic pattern in both plots, but not an obvious seasonal pattern. 

**1b.** (Trend and seasonality) Fit the *weekly* domestic passenger count with a non-parametric trend using splines and monthly seasonality using ANOVA. Is the seasonality significant? Plot the fitted values together with the original time series. Plot the residuals and the ACF of the residuals. Comment on how the model fits and on the appropriateness of the stationarity assumption of the residuals.

```{r non-parametric trend (weekly)}

```

*Response:*

**1c.** (Trend and seasonality) This time fit the *daily* domestic passenger count with a non-parametric trend using splines, monthly and day-of-the-week seasonality using ANOVA. Plot the fitted values together with the original time series. Are the seasonal effects significant? Plot the residuals and the ACF of the residuals. Comment on how the model fits and on the appropriateness of the stationarity assumption of the residuals.

```{r non-parametric trend (daily)}

```

*Response:*

# Question 2. ARMA fitting and residual analysis

**2a.** (ARMA fitting) Fit a ARMA model with both AR and MA orders of 6 without intercept using the residual processes from Question 1b and 1c for the daily and weekly domestic passenger count, respectively. What are the coefficients of the fitted models? Are the fitted ARMA models causal? (Hint: Set include.mean = FALSE if using arima(). Use polyroot() to find the roots of a polynomial.)

```{r ARMA fitting}

```

*Response* 

**2b.** (Residual analysis) Plot the residual processes of the two fitted models in Question 2a. Display the ACF, PACF, QQ-plot of these residual processes. Do the residual processes satisfies the assumptions of the R implementation?

```{r residual analysis and plot}

```

*Response* 

# Question 3. ARMA fitting and model selection: Differenced daily domestic passenger count

**3a.** (Differencing for seasonality) Difference the daily domestic passenger count by 7 days, then again by 365 days. Plot the differenced time series, its ACF and PACF. Does this looks like a pure AR/MA process from the ACF/PACF plot?

```{r differencing for seasonality}

```

*Response:* 

**3b.** (ARMA fitting and order selection). Fit an ARMA model without intercept using the differenced daily data with AR and MA order up to 8. Select the best ARMA model using AICc. What is the order for the selected model and what is its AICc?

```{r ARMA model}

```

*Response:* 

**3c.** (Residual analysis) Plot the residual process of the selected model in Question 3b. Display the ACF, PACF and QQ plot of the residual process. How does this model compare to the one on daily passenger count data in Question 2b?

```{r residual analysis}

```

*Response:* 

**3d.** (Testing uncorrelated residuals) Use the Ljung-Box Test to decide whether the residuals of the selected ARMA model in Question 3b are correlated.

```{r Ljung-Box test}

```

*Response:* 

# Question 4. Seasonal ARMA model and forecasting: Weekly domestic passenger count

**4a.** (Seasonal ARMA) Use the first 185 data points of weekly domestic passenger count as training data. Fit a seasonal ARMA model with intercept, where the non-seasonal model is ARMA(1,1) and the seasonal model is AR(1) with a period of 52 weeks. Plot the residual process and the ACF of the residual process. Comment on the appropriateness of the fitted model.

```{r Seasonal ARMA}

```

*Response:* 

**4b.** (Forecasting) Use the fitted model in Question 4a to predict the total passenger count of the remainder of the weeks. Plot the 99% confidence interval. Compare with the actual observation. Does the actual observation fell into the 99% confidence interval?

```{r forecasting}

```

*Response* 